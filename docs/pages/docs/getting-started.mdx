# Getting Started

## Installation

:::code-group

```bash [yarn]
yarn add @omnisat/lasereyes
```

```bash [npm]
npm install @omnisat/lasereyes
```

```bash [pnpm]
pnpm i @omnisat/lasereyes
```

```bash [bun]
bun i @omnisat/lasereyes
```

:::

## Quick Start

1. Wrap your app with the `LaserEyesProvider`:

```jsx
// note: component MUST NOT be rendered with SSR
import { LaserEyesProvider, MAINNET } from '@omnisat/lasereyes';

function App() {
  return (
    <LaserEyesProvider config={{ network: MAINNET }}>
      {/* Your app components */}
    </LaserEyesProvider>
  );
}
```

2. Use the `useLaserEyes` hook in your components:

```jsx
import { useLaserEyes, UNISAT } from "@omnisat/lasereyes";

function WalletConnector() {
  const {
    connect,
    connected,
    address,
    balance,
    sign,
    sendBTC,
    signPsbt,
    switchNetwork,
  } = useLaserEyes();

  const handleConnect = () => {
    connect(UNISAT);
  };

  const handleSendBTC = async () => {
    const recipient = "bc1qar0srrr7xfkvy5l643lydnw9re59gtzzwf5mdq";
    const amount = 1000; // ðŸ˜Ž
    await sendBTC(recipient, amount);
  };

  const handleSignMessage = async () => {
    const message = "SIGN ME, BABY";
    const signature = await sign(message);
    console.log(signature);
  };

  const handleSignPsbt = async () => {
    const psbtBase64 = "..."; // Your PSBT as a base64 string
    const tx = await signPsbt(psbtBase64);
    console.log(tx);
  };

  const handleSwitchNetwork = () => {
    switchNetwork("testnet");
  };

  return (
    <div>
      {!connected ? (
        <button onClick={handleConnect}>Connect Wallet</button>
      ) : (
        <div>
          <p>Connected Address: {address}</p>
          <p>Balance: {balance.total}</p>

          <button onClick={handleSendBTC}>Send BTC</button>

          <button onClick={handleSignMessage}>Sign Message</button>

          <button onClick={handleSignPsbt}>Sign PSBT</button>

          <button onClick={handleSwitchNetwork}>Switch Network</button>
        </div>
      )}
    </div>
  );
}

```

## API Reference

### LaserEyesProvider

The main context provider that should wrap your app.

### useLaserEyes

A hook that provides access to all wallet functions and state. Here are the key properties and methods:

#### Properties

`connected`: Boolean
- Indicates if a wallet is currently connected.

`isConnecting`: Boolean
- Indicates if a wallet connection is in progress.

`address`: String
- The current wallet address.

`paymentAddress`: String
- The current wallet payment address (may be different from `address` for some wallet types).

`publicKey`: String
- The current wallet public key.

`paymentPublicKey`: String
- The current wallet payment public key (may be different from `publicKey` for some wallet types).

`balance`: Number | undefined
- The current wallet balance in satoshis. `undefined` if not yet fetched.

`provider`: String | undefined
- Current wallet provider (e.g., 'unisat'). `undefined` if not connected.

`network`: 'mainnet' | 'testnet'
- Current network the wallet is connected to.

`accounts`: String[]
- Array of accounts associated with the connected wallet.

`hasUnisat`: Boolean
- Indicates if the Unisat wallet is available in the browser.

#### Methods

`connect(walletName: 'unisat'): Promise<void>`
- Connects to the specified wallet.
- Input: Wallet name (currently only 'unisat' is supported)
- Output: Promise that resolves when connection is successful, or rejects with an error.

`disconnect(): void`
- Disconnects the current wallet.
- No input or output.

`requestAccounts(): Promise<string[]>`
- Requests accounts from the connected wallet.
- Output: Promise that resolves with an array of account addresses.

`getNetwork(): Promise<string | undefined>`
- Retrieves the current network.
- Output: Promise that resolves with the network name ('mainnet' or 'testnet'), or `undefined` if not connected.

`switchNetwork(network: 'mainnet' | 'testnet' ): Promise<void>`
- Switches the wallet to the specified network.
- Input: Network name ('mainnet' or 'testnet')
- Output: Promise that resolves when the network switch is complete.

`getPublicKey(): Promise<string>`
- Retrieves the public key of the connected wallet.
- Output: Promise that resolves with the public key as a string.

`getBalance(): Promise<string>`
- Retrieves the current balance of the connected wallet.
- Output: Promise that resolves with the balance as a string (in satoshis).

`getInscriptions(): Promise<any[]>`
- Retrieves inscriptions associated with the connected wallet.
- Output: Promise that resolves with an array of inscription objects.

`sendBTC(to: string, amount: number): Promise<string>`
- Sends Bitcoin to a specified address.
- Input:
`to`: Recipient's Bitcoin address
`amount`: Amount to send in satoshis
- Output: Promise that resolves with the transaction ID.

`signMessage(message: string): Promise<string>`
- Signs a message with the connected wallet.
- Input: Message to sign
- Output: Promise that resolves with the signature.

`signPsbt(tx: string, finalize?: boolean, broadcast?: boolean): Promise<{ signedPsbtHex?: string, signedPsbtBase64?: string, txId?: string } | undefined>`
- Signs a Partially Signed Bitcoin Transaction (PSBT).
- Input:
`tx`: PSBT as a hex or base64 string
`finalize`: (optional) Whether to finalize the PSBT
`broadcast`: (optional) Whether to broadcast the transaction after signing
- Output: Promise that resolves with an object containing the signed PSBT in hex and base64 formats, and the transaction ID if broadcast.

`pushPsbt(tx: string): Promise<string | undefined>`
- Pushes a signed PSBT to the network.
- Input: Signed PSBT as a string
- Output: Promise that resolves with the transaction ID.

#### Usage Example

```jsx
function WalletInfo() {
  const { connected, address, balance, getInscriptions } = useLaserEyes();

  useEffect(() => {
    if (connected) {
      getInscriptions().then(inscriptions => {
        console.log('Inscriptions:', inscriptions);
      });
    }
  }, [connected, getInscriptions]);

  if (!connected) return <p>Please connect your wallet</p>;

  return (
    <div>
      <p>Address: {address}</p>
      <p>Balance: {balance} satoshis</p>
    </div>
  );
}
```

This example demonstrates how to use the `useLaserEyes` hook to display wallet information and fetch inscriptions when connected.


## Supported Wallets

- [Unisat](https://unisat.io)

Each wallet has different capabilities and methods of interaction. The package abstracts these differences to provide a unified API.

## Network Handling

The package supports both mainnet and testnet. You can switch networks using the `switchNetwork` function, and check the current network with the `network` property.

## Error Handling

Most functions in the package are asynchronous and may throw errors. It's recommended to use try-catch blocks when calling these functions:

```javascript
try {
  await connect('unisat');
} catch (error) {
  console.error('Failed to connect:', error);
}
```

## Advanced Usage

### Custom Configuration

You can create a custom configuration using the `createConfig` function:

```javascript
import { createConfig } from '@omnisat/lasereyes';

const config = createConfig({
  network: 'testnet',
  provider: 'unisat',
  chainId: 1,
});
```

### Working with PSBTs

The package provides methods for signing and pushing Partially Signed Bitcoin Transactions (PSBTs):

```javascript
const psbt = '...'; // Your PSBT string
const signedPsbt = await signPsbt(psbt, true, false);
const txId = await pushPsbt(signedPsbt);
```

## Best Practices

1. Always check if a wallet is connected before performing operations.
2. Handle network changes gracefully, as they can affect address and balance.
3. Provide clear feedback to users during wallet operations, as they may require user interaction in the wallet interface.
4. Always validate user input before sending transactions or signing messages.

## Contributing

Contributions are welcome! Please check out our [Contributing Guide](/docs/contributing) for more details.

## License

This project is licensed under the MIT License - see the [LICENSE](/docs/license) file for details.
